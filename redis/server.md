# 服务器

## 命令请求的执行过程

1. 客户端将命令请求发送给服务器
2. 服务器读取命令请求，并分析出命令参数
3. 命令执行器根据参数查找命令的实现函数，然后执行实现函数并得到命令回复
4. 服务器将命令回复返回给客户端

## serverCron函数

1. 更新服务器时间缓存
   * 为了减少系统调用的执行次数，缓存了时间，unixtime、mstime。
   * 这俩属性的更新频率100ms一次。
   * 打印日志、更新服务器LRU时钟、决定是否执行持久化任务、计算服务器上线时间这类精度要求不高的功能使用。
2. 更新LRU时钟
   * lruclock: 服务器LRU时钟，10s一次，用于计算键的空转时长
   * INFO server命令可查询其值。
3. 更新服务器每秒执行命令次数
   * trackOperationsPerSecond 100ms一次，估算记录服务器在最近一秒钟处理的命令请求数量。INFO status查看其值。
4. 更新服务器内存峰值记录
   * stat\_peak\_memory 服务器内存峰值大小
5. 处理SIGTERM信号
6. 管理客户端资源
7. 管理数据库资源
8. 执行被延迟的BGREWRITEAOF
9. 检查持久化操作的运行状态
10. 将AOF缓冲区中的内容写入AOF文件
11. 关闭异步客户端
12. 增加croploops计数器的值

## 初始化服务器

1. 初始化服务器状态结构
2. 载入配置选项
3. 初始化服务器数据结构
4. 还原数据库状态
5. 执行事件循环

