# 事务

## 事务的实现

1. 事务开始 MULTI
2. 命令入队 除EXEC、DISCARD、WATCH、MULTI之外的命令都入事务队列
3. 事务执行 EXEC

### WATCH命令的实现

WATCH命令是一个乐观锁，它可以在EXEC命令执行之前，监视任意数量的数据库键，并在EXEC执行命令时，检查被监视的键是否至少有一个已经被修改过了（REDIS\_DIRTY\_CAS标志），如果是的话，服务器将拒绝执行事务，并向客户端返回代表事务执行失败的空回复。

