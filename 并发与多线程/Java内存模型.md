# Java内存模型

JMM 的主要目的是定义程序中各种变量的访问规则，即关注在虚拟机中把变量值存储到内存和从内存中取出变量值这样的底层细节。

主内存： 静态字段、实例字段、构成数组对象的元素
线程私有： 局部变量和方法参数
工作内存：抽象概念，保存被该线程使用的变量的主内存副本（可能只是存了一下引用）

## Q & A

Q: 线程之间如何通信？

A: 共享内存、消息传递

---

Q: 线程之间如何同步？

A: 共享内存：程序员必须显式地指定某个方法或某段代码需要在线程之间互斥执行。

消息传递： 由于消息地发送必须在接收之前，因此同步是隐式执行的。

## Java内存模型的抽象结构

Java线程之间的通信由Java内存模型控制，JMM决定一个线程对共享变量的写入何时对另一个线程可见。

本地内存【抽象概念】

## 重排序

- 编译器优化的重排序
- 指令级并行的重排序
- 内存系统的重排序

## 内存屏障类型

- LoadLoad
- StoreStore
- LoadStore
- StoreLoad

## happens-before 原则

- 程序次序规则: 控制流顺序
- 管程锁定规则：unlock -> lock
- volatile变量规则
- 线程启动规则
- 线程终止规则
- 线程中断规则
- 对象终结规则
- 传递性
